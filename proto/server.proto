syntax = "proto3";
package game.server;

import "common.proto";

message ServerMessage {
  oneof payload {
    RoomJoined room_joined = 1;
    RoomUpdate room_update = 2;
    GameStarting game_starting = 3;
    GameState game_state = 4;
    RoundEnded round_ended = 5;
    GameEnded game_ended = 6;
    PlayerLeft player_left = 7;
    Error error = 8;
  }
}

message RoomJoined {
  uint32 player_id = 1;
  string room_code = 2;
  repeated PlayerInfo players = 3;
}

message PlayerInfo {
  uint32 player_id = 1;
  string name = 2;
  bool ready = 3;
}

message RoomUpdate {
  repeated PlayerInfo players = 1;
}

message GameStarting {
  uint32 countdown_seconds = 1;
  game.common.Vec2 spotlight = 2;
}

message GameState {
  uint32 tick = 1;
  repeated game.common.PlayerState players = 2;
  game.common.Vec2 spotlight = 3;
  float round_time_remaining = 4;
}

message RoundEnded {
  uint32 round_number = 1;
  repeated PlayerScore scores = 2;
  uint32 next_round_in = 3;
}

message PlayerScore {
  uint32 player_id = 1;
  uint32 score = 2;
}

message GameEnded {
  repeated PlayerScore final_scores = 1;
  uint32 winner_id = 2;
}

message PlayerLeft {
  uint32 player_id = 1;
}

message Error {
  string message = 1;
}